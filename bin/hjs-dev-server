#!/usr/bin/env node
var fs = require('fs')
var path = require('path')
var webpack = require('webpack')
var WebpackDevServer = require('webpack-dev-server')
var argv = require('minimist')(process.argv.slice(2))
var findRoot = require('find-root')
var rootFolder = findRoot(process.env.PWD)

// get config
if (argv.config) {

    console.log('config', argv.config)
  argv.config = require(path.resolve(argv.config));
  console.log(argv.config)
} else {
  argv.config = require(path.resolve(path.join(rootFolder, 'webpack.config.js')))
}

var hostname = argv.config.spec.hostname
var port = argv.config.spec.port

// run it
new WebpackDevServer(webpack(argv.config), {
  historyApiFallback: true,
  hot: true
}).listen(port, hostname, function (err, result) {
  if (err) {
    console.log(err)
  }
  console.log('development server running at: http://' + hostname + ':' + port)
})
